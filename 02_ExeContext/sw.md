# 실행 컨텍스트
실행 컨텍스트는 실행할 코드에 대해 제공할 환경 정보를 모아놓은 객체
자바스크립트의 동적 언어로서의 성격을 가장 잘 파악할 수 있다

## 실행 컨텍스트란
스택은 출입구가 하나 뿐인 자료구조로 후입선출
많은 프로그래밍 언어들은 스택이 넘치면 에러를 발생시킨다
자바스크립트도 콜 스택 초과 시 에러가 발생한다

큐는 양쪽이 모두 열려있는 자료구조로 양쪽 모두에서 입출력이 가능하지만
보통은 한 쪽을 입구로 한 쪽은 출구로 사용하여 선입선출 구조로 사용한다

자바스크립트는 동일한 환경 내의 코드들이 필요한 환경 정보들을 모아
컨텍스트를 구성하고 콜 스택에 쌓아두었다가
가장 위에 쌓여있는 컨텍스트의 코드들을 실행하는 식으로 전체 코드의 환경과 순서를 보장한다

여기서 동일한 환경이란 하나의 실행 컨텍스트를 구성할 수 있는 것으로
전역, eval(), 함수 등의 환경이 있다
자동으로 생성되는 전역 공간과 노답인 eval 을 제외하면
실행 컨텍스트의 구성은 함수로만 이루어져있다고 볼 수 있다

## 동작 순서
자바스크립트 프로그램이 실행되는 순간 전역 컨텍스트가 콜 스택에 담긴다
전역 컨텍스트는 프로그램의 시작부터 끝까지 함께 한다
전역 컨텍스트는 일반적인 실행 컨텍스트와 같지만
프로그램이 실행되기 위한 기반을 마련하는 암묵적인 코드로
별도의 실행 명령 없이 브라우저에서 자동으로 실행한다
다른 모든 컨텍스트들은 이 전역 컨텍스트 위에서 동작한다고 보면된다

항상 콜스택의 최상단 코드가 실행되고
이 실행중인 컨텍스트를 활성 컨텍스트라고 부른다
활성 컨텍스트의 정보들을 자바스크립트 엔진이 실행 컨텍스트 객체에 저장한다
이 객체는 자바스크립트 엔진이 활용하는 것이기 때문에 사용자는 확인할 수 없다

실행 컨텍스트의 구성
- VariableEnviroment: 현재 컨텍스트 내의 식별자들의 정보와 외부 환경 정보, 선언 시점의 LexicalEnviroment 의 스냅샷 으로 변경 사항은 반영되지 않는다

- LexicalEnviroment: VariableEnviroment 에 자신의 스냅샷을 제공한 이후 벼경 사항이 실시간으로 반영된다

- ThisBinding: this 식별자가 바라보는 대상 객체

### VariableEnviroment
최초 실행 시의 LexicalEnviroment 의 첫 모습을 스냅샷으로 간직한다
이후에는 LexicalEnviroment 를 주로 활용한다

VariableEnviroment 와 LexicalEnviroment 내부에는
enviromentRecord (환경 레코드) 와 outer-EnviromentReference (외부 환경 참조) 로 구성되어 있다
### LexicalEnviroment
어휘적 환경, 정적 환경 (사전적 환경)
컨텍스트를 구성하는 환경 정보들을 찾을 수 있는 모아놓은 환경

### 환경레코드와 호이스팅
환경레코드에는 현재 컨텍스트와 관련된 코드의 식별자 정보들이 저장된다
식별자에는 함수와 매개변수, 내부 변수 등이 해당되며
컨텍스트 내부 전체를 처음부터 끝까지 순서대로 수집한다

자바스크립트 코드가 실행되기 이전에 자바스크립트 엔진은 내부 환경의 모든 식별자 선언문을
알고 있다
이를 호이스팅이라고 부른다
모든 식별자 선언문을 코드 최상단으로 끌어올린 것과 같이 동작하기 때문

#### 호이스팅 규칙
환경 레코드에는 매개변수의 이름, 함수 선언, 변수명 등이 담긴다
렉시컬 환경 입장에서 함수의 매개변수는 내부에 변수를 선언한 것과 같다
모든 선언문이 코드 최상단에 위치한 것 처럼 동작한다

함수 선언식 `function a() {}` 은 함수 전체에 호이스팅이 일어나고
함수 표현식 `var a = () => {}` 은 변수에 대한 호이스팅만 일어난다
표현식은 함수를 하나의 값으로 평가하는 것인데
이는 자바스크립트가 멀티 패러다임 언어이기 때문에 가능한 것이다
함수를 값으로 평가하는 것은 자바스크립트의 함수가 1급 객체이기 때문이다

전역 컨텍스트가 활성화 되면 전역 공간에 선언된 함수들이 호이스팅 된다
동일한 변수명에 서로 다른 값을 할당할 경우
가장 마지막에 할당된 값이 이전 값을 덮어 씌운다

### 스코프와 스코프 체인, 외부 환경 참조
스코프란 식별자에 대한 유효 범위다
ES5 까지의 자바스크립트는 오직 함수만이 스코프를 가졌는데
ES6 부터 모든 제어문이 스코프를 가진다

스코프 체인은 식별자의 유효 범위가 내부에서 부터 바깥으로 (아래에서 위로) 차례대로
연결되어 있어 상위 스코프에 대한 식별자 참조가 가능한 것을 말한다
스코프 체인을 가능하게 하는 것이 렉시컬 환경의 외부 환경 참조다

#### 스코프 체인
외부 환경 참조는 현재 호출된 함수가 선언될 당시의 렉시컬 환경을 참조한다
여기서 선언의 시점은 콜 스택 상에서 실행 컨텍스트가 활성화 되었을 때뿐이다

외부 환경 참조는 연결 리스트 형태를 띈다
선언 시점의 렉시컬 환경을 계속 찾아 올라가면 마지막에
전역 컨텍스트의 렉시컬 환경을 만난다

외부 환경 참조는 자신이 선언된 시점의 렉시컬 환경을 참조하므로
가장 가까운 요소애만 접근할 수 있다

스코프 체인 내에 있다고 모두 참조할 수 있는 것은 아니다
책에서는 클로저를 변수 은닉화 라고 소개하고 있다

### this
실행 컨텍스트의 thisBinding 에는 this 로 지정된 객체가 저장된다
실행 컨텍스트 활성화 당시 this 가 지정되지 않은 경우 전역 객체가 저장된다


