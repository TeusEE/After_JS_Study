# This

### 시작에 앞서

자바스크립트를 다루면서 가장 혼란스러운 개념을 꼽으라하면 거의 첫번째로 this를 뽑을 것입니다.

다른 대부분의 객체지향 언어에서 this는 클래스로 생성한 인스턴스 객체를 의미합니다.

그러나 자바스크립트에서의 this는 어디서든 사용할 수 있기 때문에 정말 혼란스럽습니다.

상황에 따라, 공간에 따라, 다른 이유로든 다양하게 this를 다루기 때문에 정말 자세히 알아야합니다.

### 상황에 따라 달라지는 this

- 자바스크립트에서 this는 기본적으로 실행 컨텍스트가 생성될 때 함께 결정됩니다.
- 바꿔말하면, this는 함수를 호출할 때 결정된다고 할 수 있습니다.

#### 전역 공간에서 this

전역 공간에서 this는 전역 객체를 가리킵니다.

```javascript
var a = 1;
console.log(a); // 1
console.log(window.a); // 1
console.log(this.a); // 1
```

> 전역 공간에서의 this는 전역객체를 의미하므로 두 값이 같은 값을 출력하는 것이 당연하지만, 그값이 1인 것이 의아합니다. <br/>그 이유는 `자바스크립트의 모든 변수는 실은 특정 객체의 프로퍼티`로서 동작하기 때문입니다.

> 특정 객체란 바로 실행 컨텍스트의 LexicalEnvironment 입니다.

#### 메서드로서 this

##### 함수 vs 메서드

`함수`는 그 자체로 독립적인 기능을 수행하는 반면, `메서드`는 자신을 호출한 대상 객체에 관한 동작을 수행합니다.

자바스크립트는 상황별로 this 키워드에 다른 값을 부여하게 함으로써 이를 구현했습니다.

```javascript
// 함수로서 호출, 메서드로서 호출
var func = function (x) {
  console.log(this, x);
};

func(1); // Window { ... } 1

var obj = {
  method: func,
};
obj.method(2); // { method: f } 2
```

- this에는 호출한 주체의 정보가 담깁니다. 점 표기법의 경우, 마지막 점 앞에 명시된 객체가 곧 this의 주체입니다.

```javascript
// 메서드 내부에서의 this
var obj = {
  methodA: function () {
    console.log(this);
  },
  inner: {
    methodB: function () {
      console.log(this);
    },
  },
};
obj.methodA(); // obj
obj.inner.methodB(); // obj.inner
```

#### 함수로서 호출할 때 그 함수 내부에서 this

- 어떤 함수를 함수로서 호출할 경우에는 this가 지정되지 않습니다.
- ES6에서 함수 내부에서 this가 전역 객체를 바라보는 문제를 보완하고자 화살표 함수를 도입

#### 콜백 함수 호출 시 그 함수 내부에서 this

- 콜백 함수 내부에서의 this도 기본적으로 함수이기 때문에 전역객체를 바라봅니다. 하지만 제어권을 받은 함수에서 콜백 함수에 별도로 this가 될 대상을 지정한 경우는 그 대상을 참조합니다.

#### 생성자 함수 내부에서 this

- 어떤 함수가 생성자 함수로서 호출된 경우 내부에서 this는 인스턴스 자신이 됩니다.
- 생성자 함수를 호출(new 명령어와 함께 함수를 호출)하면 우선 생성자의 prototype 프로퍼티를 참조하는 **proto**라는 프로퍼티가 있는 객체(인스턴스)를 만들고, 미리 준비된 공통 속성 및 개성을 해당 객체(this)에 부여합니다.

### 명시적으로 this를 바인딩하는 방법

앞 절에서 상황별로 this에 어떤 값이 바인딩되는지를 살펴봤지만 이러한 규칙을 깨고 this에 별도의 대상을 바인딩하는 방법도 있습니다.

#### call 메서드

`Function.prototype.call(thisArg[, arg1[, arg2[, ...]]])`

call 메서드는 메서드의 호출 주체인 함수를 즉시 실행하도록 하는 명령입니다.

#### apply 메서드

`Function.prototype.apply(thisArg[, argsArray])`

apply 메서드는 call 메서드와 기능적으로 완전히 동일합니다. 두번째 인자를 배열로 받아 그 배열 요소들을 함수의 매개변수로 지정한다는 차이점이 있습니다.

#### bind 메서드

`Function.prototype.bind(thisArg[, arg1[, arg2[, ...]]])`

bind 메서드는 ES5에서 추가된 기능으로, call과 비슷하지만 즉시 호출하지는 않고 넘겨 받은 this 및 인수들을 바탕으로 새로운 함수를 반환하기만 하는 메서드입니다.

##### name 프로퍼티

bind 메서드를 적용해서 새로 만든 함수는 한가지 독특한 성질이 있습니다.

바로 name 프로퍼티에 동사 bind의 수동태인 'bound'라는 접두어가 붙는다는 점입니다.

#### 화살표 함수의 예외사항

ES6에 새롭게 도입된 화살표 함수는 실행 컨텍스트 생성 시 this를 바인딩하는 과정이 제외됐습니다.

즉, 이 함수 내부에는 this가 아예 없으며, 접근하고자 하면 스코프체인상 가장 가까운 this에 접근하게 됩니다.
